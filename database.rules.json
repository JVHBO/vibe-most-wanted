{
  "rules": {
    "profiles": {
      "$address": {
        // Leitura pública permitida (necessário para leaderboard)
        ".read": true,
        // Escrita restrita: apenas validação básica
        ".write": "newData.hasChildren(['address', 'username', 'stats']) && newData.child('address').val() === $address"
      }
    },
    "usernames": {
      // Leitura pública (necessário para validar usernames)
      ".read": true,
      // Escrita: apenas se estiver criando/atualizando perfil válido
      ".write": "root.child('profiles').child(newData.val()).exists()"
    },
    "playerMatches": {
      "$address": {
        // Leitura pública (necessário para mostrar histórico)
        ".read": true,
        // Escrita apenas para o próprio jogador ou matches válidos
        ".write": "newData.hasChildren(['opponent', 'result', 'timestamp'])"
      }
    },
    "rooms": {
      "$roomCode": {
        // Leitura pública (necessário para PvP)
        ".read": true,
        // Escrita: validar estrutura mínima de sala
        ".write": "newData.hasChildren(['player1', 'createdAt']) || !newData.exists()"
      }
    },
    "matchmaking": {
      "$address": {
        // Leitura pública (necessário para matchmaking)
        ".read": true,
        // Escrita: validar timestamp
        ".write": "newData.hasChildren(['timestamp']) || !newData.exists()"
      }
    },
    "notificationTokens": {
      "$fid": {
        ".read": true,
        ".write": "newData.hasChildren(['token', 'url'])"
      }
    }
  }
}
